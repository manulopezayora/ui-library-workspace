<div class="input-container">
    @if (label()) {
        <label [class.is-invalid]="isInvalid" [for]="id()">
            {{ label() }}
        </label>
    }

    <div
        #trigger
        class="select-trigger input-field"
        role="combobox"
        aria-haspopup="listbox"
        aria-controls="select-panel"
        tabindex="0"
        [attr.aria-activedescendant]="activeIndex() >= 0 ? 'option-' + activeIndex() : null"
        [attr.aria-expanded]="isOpen()"
        [class.primary]="fieldStyle() === 'primary'"
        [class.secondary]="fieldStyle() === 'secondary'" [class.outline]="fieldStyle() === 'outline'"
        [class.is-invalid]="isInvalid" [class.disabled]="disabled()" (click)="toggle()"
        (keydown)="onTriggerKeydown($event)"
    >
        {{ selectedLabel() || placeholder() }}
    </div>

    @if (isInvalid) {
    <small class="error-text">
        {{ errorMessages.join(', ') }}
    </small>
    }
</div>

<ng-template #panel>
    <div
        class="select-panel"
        id="select-panel"
        role="listbox"
        aria-haspopup="listbox"
        tabindex="0"
        (keydown)="handleKeydown($event)"
    >
        @for (option of options(); track option.value; let i = $index) {
            <div
                class="select-option"
                role="option"
                [id]="'option-' + i"
                tabindex="0"
                [attr.aria-selected]="option.value === value()"
                [class.active]="i === activeIndex()"
                [class.selected]="option.value === value()"
                (click)="select(option, i)"
                (keydown)="handleKeydown($event)"
            >
                {{ option.label }}
            </div>
        }
    </div>
</ng-template>